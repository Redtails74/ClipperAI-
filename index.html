<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clipper AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="{{ url_for('static', filename='code_clipper_logo.jpg') }}" alt="Clipper Logo" class="logo">
        </div>
    </header>
    <main>
        <div id="app">
            <div class="logo-container">
                <img src="{{ url_for('static', filename='code_clipper_logo.jpg') }}" alt="Clipper Logo" class="logo">
            </div>
            <textarea id="input" placeholder="Type your message..."></textarea>
            <button id="send">Send</button>
            <div id="chat"></div>
        </div>
    </main>
    <script>
        const input = document.getElementById('input');
        const sendButton = document.getElementById('send');
        const chatDiv = document.getElementById('chat');

        async function sendMessage() {
            const message = input.value.trim();
            if (!message) return;

            updateChat('User', message);
            updateChat('AI', 'Loading...', true);

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message })
                });

                if (response.ok) {
                    const data = await response.json();
                    updateChat('AI', data.response);
                } else {
                    updateChat('Error', response.statusText);
                }
            } catch (error) {
                updateChat('Error', error.message);
            }

            input.value = '';
        }

        function updateChat(speaker, message, isLoading = false) {
            chatDiv.innerHTML += `<div><strong>${speaker}:</strong> ${message}</div>`;
            chatDiv.scrollTop = chatDiv.scrollHeight;

            if (isLoading) {
                setTimeout(() => chatDiv.lastElementChild.remove(), 1000);
            }
        }

        sendButton.addEventListener('click', sendMessage);
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                sendMessage();
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
